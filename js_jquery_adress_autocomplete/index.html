

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="#">

    <script src="../js_libraries/jquery/jquery.min.js" ></script>
    <link rel="stylesheet" href="../js_libraries/jquery-ui/jquery-ui.min.css">
    <script src="../js_libraries/jquery-ui/jquery-ui.min.js" ></script>
    <script src="/../js_module_exemple/script.js" type="module"></script>
    <script src="/js_jquery_adress_autocomplete/script.js" type="module"></script>

    <title>Module recherche adresse</title>
</head>
<body>

    <div class="ui-widget">
        <label for="adresseSearchInput">Recherche: </label>
        <input type="search" name="adresse" id="adresseSearchInput">
        <br>
        <small id="info"></small>
    </div>

</body>
</html>

<script type="module">

    import api from '../js_module_exemple/script.js'
    import adresseAutoComplete from '/js_jquery_adress_autocomplete/script.js'

    const inputSearch = adresseAutoComplete.initSearchElement('adresseSearchInput');
    const info = document.getElementById('info');

    inputSearch.addEventListener('input', async (e) => {
        if (inputSearch.value.length < 3) {
            adresseAutoComplete.displayNoResults(info);
            adresseAutoComplete.resetOptions();
            adresseAutoComplete.resetResults();
            return;
        }

        try {

            const results = await api.apiGet(`https://api-adresse.data.gouv.fr/search/?q=${adresseAutoComplete.setQuery(inputSearch)}`);

            if (results && results.features && results.features.length >= 1) {
                await adresseAutoComplete.setAdresseSearchResults(results.features);
                await adresseAutoComplete.setAdressSearchOptions(results.features);
                adresseAutoComplete.initializeAutocomplete(); // Pas besoin d'attendre ici
            } else {
                adresseAutoComplete.displayNoResults(info);
            }
        } catch (error) {
            console.error('Erreur lors de la récupération des résultats:', error);
            adresseAutoComplete.displayNoResults(info);
        }
    });


</script>



